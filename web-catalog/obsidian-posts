import json
from notion_client import Client
import datetime

# Используйте свой токен Notion и ID страницы
NOTION_TOKEN = "secret_Kafh5RzIJpHR9TjV1h6b7s2jblnKvzFCS5q2LjtZuMJ"
NOTION_PAGE_ID = "e8c62c331daf4ae0a33d946e1b03ef70"
DATABASE_ID = "3b703df52bc440b3be1ea494306f0d36"  # Замените на ID вашей базы данных

client = Client(auth=NOTION_TOKEN)

def get_pages_and_blocks():
    # Получение содержимого страницы
    page_content = client.pages.retrieve(NOTION_PAGE_ID)

    # Получение блоков страницы
    blocks = client.blocks.children.list(NOTION_PAGE_ID)

    # Сохранение данных в JSON строку
    page_content_json = json.dumps(page_content, ensure_ascii=False, indent=4)
    blocks_json = json.dumps(blocks, ensure_ascii=False, indent=4)

    # Получение названия страницы и даты создания
    page_title = page_content["properties"]["title"]["title"][0]["plain_text"]
    page_created_time = datetime.datetime.strptime(page_content["created_time"], "%Y-%m-%dT%H:%M:%S.%fZ").strftime("%Y-%m-%d")

    # Сохранение данных в файл
    file_name = f"{page_title}_{page_created_time}.json"
    with open(file_name, 'w', encoding='utf-8') as file:
        file.write(page_content_json)
        file.write(blocks_json)

# Из json файла вывести все блоки с текстом и заголовками

def get_blocks_from_json(page_title, page_created_time):
    # Открытие файла
    with open(f"{page_title}_{page_created_time}.json", encoding='utf-8') as file:
        data = json.load(file)

    # Получение блоков
    blocks = data["results"]
    
		# Получение текста и заголовков
for block in blocks: 
				block_id = block["id"]
				block_type = block["type"]
				block_title = block["properties"]["title"][0]["plain_text"]
				block_text = block["paragraph"]["text"][0]["plain_text"]
				print(f"ID: {block_id}\nТип: {block_type}\nЗаголовок: {block_title}\nТекст: {block_text}\n")
          


   
